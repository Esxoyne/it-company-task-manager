{% extends "base.html" %}

{% block title %}
  {{ user.username }}
{% endblock %}

{% block navigation %}
  {% include "includes/nav_worker_detail.html" %}
{% endblock %}

{% block content %}
  <div class="row align-items-center">
    <div class="col-auto">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="128"
        height="128"
        fill="currentColor"
        class="bi bi-person-square"
        viewBox="0 0 16 16"
      >
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12z"/>
      </svg>
    </div>
    <div class="col-auto me-auto">
      {% if worker.first_name and worker.last_name %}
        <h1>{{ worker.first_name }} {{ worker.last_name }}</h1>
        {% if worker.is_staff %}
          <h2 class="fw-light">{{ worker.username }} <i class="bi bi-shield-fill-check fs-5"></i></h2>
        {% else %}
          <h2 class="fw-light">{{ worker.username}}</h2>
        {% endif %}
      {% else %}
        <h1>{{ worker.username }}</h1>
      {% endif %}
    </div>
    <div class="col-auto my-3">
      <h4 class="font-monospace">{{ worker.position }}</h4>
    </div>
  </div>
  
  <hr class="w-75 mx-auto">

  <div class="container text-center">
    <h2 class="fw-light">Assigned tasks</h2>

    {% if worker.tasks.all %}
      <div class="col-11 container justify-content-center">
        <table class="table table-striped table-hover mt-3">
          <thead class="{{ is_dark_mode|yesno:"table-light,table-dark" }}">
            <tr>
              <th>#</th>
              <th>Task</th>
              <th>Type</th>
              <th>Priority</th>
              <th>Due</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for task in worker.tasks.all %}
            <tr>
              <td>{{ task.id }}</td>
              <td>
                <a class="link-body-emphasis text-decoration-none" href="{% url "task_manager:task-detail" pk=task.id %}">{{ task.name }}</a>
              </td>
              <td>{{ task.task_type.name }}</td>
              <td>
                <span class="badge rounded-pill {{ task.priority }}-priority">
                  {{ task.priority|upper }}
                </span>
              </td>
              <td>
                {% if task.is_completed %}
                  <span class="text-success-emphasis">{{ task.deadline }}</span>
                {% elif task.is_at_risk %}
                  <span class="text-warning-emphasis">{{ task.deadline }}</span>
                {% else %}
                  <span>{{ task.deadline }}</span>
                {% endif %}
              </td>
              <td>
                {% if task.is_completed %}
                  <span class="badge rounded-pill text-bg-success"><i class="bi bi-check2"></i></span>
                {% elif task.is_at_risk %}
                  <span class="badge rounded-pill text-bg-warning"><i class="bi bi-exclamation"></i></span>
                {% else %}
                  <span class="badge rounded-pill {{ is_dark_mode|yesno:"text-bg-light,text-bg-dark" }}"><i class="bi bi-arrow-clockwise"></i></span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <span class="fw-light fs-4">This user is not assigned any tasks</span>
    {% endif %}
  </div>

  {% if user.is_staff %}
    {% include "includes/worker_delete_modal.html" %}
  {% endif %}
{% endblock %}
